<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC
        "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd"
        >
<mapper namespace="our.example.furniture.repository.PostMapper">

    <!-- INCLUDE -->
    <sql id="select_indexViewPost">
        Product.Product_No, Product.productCategory_HomeScale, Product.productCategory_NumberOfHouseholds, Product.productCategory_Interior,
        Product.productName, Product.productPrice, Product_MainImg.img_url_main
    </sql>

    <!-- 데이터베이스 상품관련 데이터 INSERT QUERY -->
    <insert id="insertProductInfo">
        INSERT INTO product(product_no, productCategory_HomeScale, productCategory_NumberOfHouseholds,
        productCategory_Interior, productName, productPrice, productGuideline, productSize, productColor, productComment)
        VALUES(PRODUCT_AUTO_I.NEXTVAL, #{productCategoryHomeScale}, #{productCategoryNumberOfHouseholds}, #{productCategoryInterior},
        #{productName}, #{productPrice}, #{productGuideline}, #{productSize}, #{productColor}, #{productComment})
    </insert>
    <insert id="InsertInnerImages" parameterType="java.util.List">
        <foreach item="item" index="index" collection="list" separator=" " open="INSERT ALL" close="SELECT * FROM DUAL">
            INTO Product_InnerImages(product_no, img_saveName, img_extName, img_fileSize, img_url_inner)
            VALUES (PRODUCT_AUTO_I.CURRVAL, #{item.saveImageName}, #{item.extName}, #{item.FileSize}, #{item.imgURL})
        </foreach>
    </insert>
    <insert id="InsertMainImage" parameterType="java.util.List">
        <foreach item="item" index="index" collection="list" separator=" " open="INSERT ALL" close="SELECT * FROM DUAL">
            INTO Product_MainImg(product_no, img_saveName, img_extName, img_fileSize, img_url_main)
            VALUES (PRODUCT_AUTO_I.CURRVAL, #{item.saveImageName}, #{item.extName}, #{item.FileSize}, #{item.imgURL})
        </foreach>
    </insert>

    <!-- 데이터베이스 상품관련 데이터 SELECT QUERY -->
    <select id="SelectPostImages" resultType="our.example.furniture.dto.SelectedPostDto" parameterType="our.example.furniture.dto.SelectedPostDto">
        SELECT
        img_url_inner
        FROM
        Product_InnerImages WHERE Product_No = #{product_No}
    </select>
    <select id="SelectPost" resultType="our.example.furniture.dto.SelectedPostDto" parameterType="our.example.furniture.dto.SelectedPostDto">
        SELECT
        <include refid="select_indexViewPost"/>
        FROM
        Product LEFT OUTER JOIN Product_MainImg ON Product.product_no = Product_MainImg.product_no
        WHERE Product.Product_No = #{product_No}
    </select>

    <!-- 데이터베이스 Pagination 관련 데이터 QUERY -->
    <select id="selectPostList" parameterType="our.example.furniture.paging.Pagination" resultType="our.example.furniture.dto.SelectedPostDto">
        SELECT
        <include refid="select_indexViewPost"/>
        FROM
        Product LEFT OUTER JOIN Product_MainImg ON Product.product_no = Product_MainImg.product_no
        ORDER BY Product.Product_no DESC
        OFFSET #{paginationInfo.firstRecordIndex} ROWS FETCH NEXT #{recordsPerPage} ROWS ONLY
    </select>
    <select id="selectPostTotalCount" parameterType="our.example.furniture.paging.Pagination" resultType="int">
        SELECT
        COUNT(*)
        FROM
        Product
    </select>
</mapper>