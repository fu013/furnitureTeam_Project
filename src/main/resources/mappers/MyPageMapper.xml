<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC
        "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd"
        >
<mapper namespace="our.example.furniture.repository.MyPageMapper">

    <!-- INCLUDE -->
    <sql id="select_indexViewPost">
        Product.Product_no, Product.productCategoryHomeScale, Product.productCategoryNumberOfHouseholds, Product.productCategoryInterior,
        Product.productName, Product.productPrice, Product.productView, Product.productColor, Product.productSize, Product_MainImg.img_url_main
    </sql>
    <!--찜목록 클릭시 db에 product_no, userRegisterId 전송-->
    <insert id="InsertDibs">
        INSERT INTO Product_Dibs(product_no, userRegisterId)
        VALUES(#{product_no}, #{userLoginId})
    </insert>
    <!--찜목록 중복클릭 확인-->
    <select id="CheckDibs" parameterType="our.example.furniture.dto.PostDTO" resultType="int">
        SELECT Count(*) from Product_Dibs where product_no = #{product_no}
    </select>
    <!--찜목록 조회-->
    <select id="selectDibsPost" parameterType="our.example.furniture.dto.PostDTO" resultType="our.example.furniture.dto.PostDTO">
        SELECT
        <include refid="select_indexViewPost"/>
        FROM
        Product LEFT OUTER JOIN Product_MainImg ON Product.product_no = Product_MainImg.product_no
        LEFT OUTER JOIN Product_Dibs ON Product.product_no = Product_Dibs.product_no
        WHERE Product.Product_No = product_dibs.product_no AND product_dibs.userRegisterId = #{userLoginId}
        ORDER BY Product.Product_no DESC
        OFFSET #{paginationInfo.firstRecordIndex} ROWS FETCH NEXT #{recordsPerPage} ROWS ONLY
    </select>
    <!--찜목록 전체 게시물 개수-->
    <select id="selectDibsPostTotalCount" parameterType="our.example.furniture.dto.PostDTO" resultType="int">
        SELECT Count(*)
        FROM Product_Dibs
        WHERE userRegisterId = #{userLoginId}
    </select>
</mapper>